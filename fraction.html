<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fraction Chef</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;700&display=swap');

        body {
            margin: 0;
            padding: 0;
            background-color: #fce8b3;
            font-family: 'Nunito', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            background-image: radial-gradient(#ffd54f 15%, transparent 16%), radial-gradient(#ffd54f 15%, transparent 16%);
            background-size: 60px 60px;
            background-position: 0 0, 30px 30px;
        }

        #game-container {
            width: 100%;
            max-width: 800px;
            height: 100%;
            display: flex;
            flex-direction: column;
            position: relative;
            background: white;
            box-shadow: 0 0 20px rgba(0,0,0,0.2);
        }

        /* Header / Score Board */
        header {
            background-color: #d32f2f;
            color: white;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 5px solid #b71c1c;
            z-index: 10;
        }

        h1 {
            font-family: 'Fredoka One', cursive;
            margin: 0;
            font-size: 1.5rem;
            text-shadow: 2px 2px 0px rgba(0,0,0,0.2);
        }

        .score-box {
            background: rgba(0,0,0,0.2);
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 1.2rem;
        }

        /* Customer Area */
        #customer-area {
            flex: 1;
            background-color: #a5d6a7; /* Wall color */
            position: relative;
            display: flex;
            justify-content: center;
            align-items: flex-end;
            border-bottom: 10px solid #795548; /* Counter top */
            overflow: hidden;
        }

        .wall-pattern {
            position: absolute;
            top: 20px;
            width: 100%;
            height: 100px;
            background: repeating-linear-gradient(
                90deg,
                transparent,
                transparent 40px,
                rgba(255,255,255,0.3) 40px,
                rgba(255,255,255,0.3) 45px
            );
        }

        #character-container {
            /* --- Changed width and height here --- */
            width: 320px;  /* Increased from 200px */
            height: 450px; /* Increased from 220px */
            position: relative;
            z-index: 2;
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            justify-content: center;
            align-items: flex-end;
        }

        #customer-img {
            width: 100%;
            height: auto;
            /* --- Changed max-height here --- */
            max-height: 450px; /* Increased from 200px */
            object-fit: contain;
        }

        #speech-bubble {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            border-radius: 30px;
            padding: 20px;
            max-width: 80%;
            text-align: center;
            border: 4px solid #333;
            box-shadow: 5px 5px 0px rgba(0,0,0,0.1);
            z-index: 5;
            font-family: 'Fredoka One', cursive;
            font-size: 1.2rem;
            color: #333;
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        #speech-bubble:after {
            content: '';
            position: absolute;
            bottom: -20px;
            left: 50%;
            border: 20px solid transparent;
            border-top-color: #333;
            border-bottom: 0;
            margin-left: -20px;
            margin-bottom: -4px;
        }
        #speech-bubble:before {
            content: '';
            position: absolute;
            bottom: -13px;
            left: 50%;
            border: 17px solid transparent;
            border-top-color: white;
            border-bottom: 0;
            margin-left: -17px;
            z-index: 1;
        }

        .fraction-highlight {
            color: #d32f2f;
            font-size: 1.5em;
        }

        /* Counter / Options Area */
        #counter-area {
            background-color: #8d6e63;
            padding: 20px;
            display: flex;
            justify-content: center;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
            box-shadow: inset 0 10px 20px rgba(0,0,0,0.2);
            min-height: 250px;
        }

        .item-option {
            background: rgba(255,255,255,0.1);
            padding: 10px;
            border-radius: 15px;
            cursor: pointer;
            transition: transform 0.2s, background 0.2s;
            text-align: center;
            border: 3px solid transparent;
        }

        .item-option:hover {
            transform: translateY(-10px);
            background: rgba(255,255,255,0.2);
            border-color: #fff;
        }

        .item-option:active {
            transform: scale(0.95);
        }

        canvas {
            filter: drop-shadow(3px 3px 2px rgba(0,0,0,0.3));
        }

        .btn-order {
            display: block;
            margin-top: 10px;
            background: #d32f2f;
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 20px;
            font-family: 'Fredoka One', cursive;
            font-size: 1rem;
            cursor: pointer;
            pointer-events: none; /* Let the container handle click */
        }

        /* Feedback Overlay */
        #feedback-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.3s;
        }

        #feedback-msg {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            border: 5px solid #d32f2f;
            transform: scale(0.8);
            transition: transform 0.3s;
        }

        #feedback-msg h2 {
            font-family: 'Fredoka One', cursive;
            margin-top: 0;
            font-size: 2.5rem;
            color: #d32f2f;
        }
        
        #feedback-msg button {
            background: #4caf50;
            color: white;
            border: none;
            padding: 10px 30px;
            font-size: 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            font-family: 'Fredoka One', cursive;
            margin-top: 20px;
            box-shadow: 0 4px #2e7d32;
        }
        
        #feedback-msg button:active {
            box-shadow: 0 0 #2e7d32;
            transform: translateY(4px);
        }

        @keyframes popIn {
            0% { transform: translateX(-50%) scale(0); }
            80% { transform: translateX(-50%) scale(1.1); }
            100% { transform: translateX(-50%) scale(1); }
        }

    </style>
</head>
<body>

<div id="game-container">
    <header>
        <h1>üçï Teacher Bea's Order</h1>
        <div class="score-box">Score: <span id="score">0</span></div>
    </header>

    <div id="customer-area">
        <div class="wall-pattern"></div>
        <div id="speech-bubble">Loading...</div>
        
        <!-- Customer Image -->
        <div id="character-container">
            <img id="customer-img" src="adi.png" alt="Customer">
        </div>
    </div>

    <div id="counter-area">
        <!-- Items will be injected here -->
    </div>
</div>

<div id="feedback-overlay">
    <div id="feedback-msg">
        <h2 id="msg-title">Awesome!</h2>
        <p id="msg-text">You got it right!</p>
        <button onclick="nextLevel()">Next Order</button>
    </div>
</div>

<script>
    const state = {
        score: 0,
        currentFraction: null, // "1/2" or "1/4"
        isLocked: false,
        itemType: 'pizza' // 'pizza', 'pie', 'apple', 'bread', 'pastry'
    };

    const speechBubble = document.getElementById('speech-bubble');
    const counterArea = document.getElementById('counter-area');
    const scoreEl = document.getElementById('score');
    const feedbackOverlay = document.getElementById('feedback-overlay');
    const msgTitle = document.getElementById('msg-title');
    const msgText = document.getElementById('msg-text');
    const characterContainer = document.getElementById('character-container');

    // Init Game
    initRound();

    function initRound() {
        state.isLocked = false;
        feedbackOverlay.style.visibility = 'hidden';
        feedbackOverlay.style.opacity = '0';
        
        // Randomly choose quest: 1/2 or 1/4
        state.currentFraction = Math.random() > 0.5 ? "1/2" : "1/4";

        // Randomly choose item type
        const itemTypes = ['pizza', 'pie', 'apple', 'bread', 'pastry'];
        state.itemType = itemTypes[Math.floor(Math.random() * itemTypes.length)];
        
        // Update Speech
        let itemName = state.itemType;
        if (itemName === 'pastry') itemName = 'pastry'; else if (itemName === 'bread') itemName = 'bread';
        
        if (state.currentFraction === "1/2") {
            speechBubble.innerHTML = `I'd like that ${itemName} cut into <span class="fraction-highlight">2 equal parts</span> please! <br>(1/2)`;
        } else {
            speechBubble.innerHTML = `Can you cut the ${itemName} into <span class="fraction-highlight">4 equal parts</span>? <br>(1/4)`;
        }

        // Generate Items
        generateItemOptions(state.currentFraction);
    }

    function generateItemOptions(target) {
        counterArea.innerHTML = '';
        
        let options = [];

        if (target === "1/2") {
            // 1. Correct (Halves)
            options.push({ cutType: 'halves', correct: true });
            // 2. Incorrect (Unequal halves)
            options.push({ cutType: 'unequal-halves', correct: false });
            // 3. Incorrect (Quarters)
            options.push({ cutType: 'quarters', correct: false });
        } else {
            // 1. Correct (Quarters)
            options.push({ cutType: 'quarters', correct: true });
            // 2. Incorrect (Halves)
            options.push({ cutType: 'halves', correct: false });
            // 3. Incorrect (Random unequal)
            options.push({ cutType: 'unequal-random', correct: false });
        }

        // Shuffle options
        options.sort(() => Math.random() - 0.5);

        options.forEach((opt, index) => {
            const wrapper = document.createElement('div');
            wrapper.className = 'item-option';
            wrapper.onclick = () => checkAnswer(opt.correct);
            
            const canvas = document.createElement('canvas');
            canvas.width = 160;
            canvas.height = 160;
            drawItem(canvas, state.itemType, opt.cutType);
            
            const btn = document.createElement('button');
            btn.className = 'btn-order';
            btn.innerText = 'SERVE';

            wrapper.appendChild(canvas);
            wrapper.appendChild(btn);
            counterArea.appendChild(wrapper);
        });
    }

    function drawItem(canvas, itemType, cutType) {
        const ctx = canvas.getContext('2d');
        const cx = canvas.width / 2;
        const cy = canvas.height / 2;
        const r = 70;

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Draw Base Item
        switch(itemType) {
            case 'pizza':
                drawPizzaBase(ctx, cx, cy, r);
                break;
            case 'pie':
                drawPieBase(ctx, cx, cy, r);
                break;
            case 'apple':
                drawAppleBase(ctx, cx, cy, r);
                break;
            case 'bread':
                drawBreadBase(ctx, cx, cy, r);
                break;
            case 'pastry':
                drawPastryBase(ctx, cx, cy, r);
                break;
        }

        // CUTS
        drawCuts(ctx, cx, cy, r, cutType, itemType);
    }

    function drawPizzaBase(ctx, cx, cy, r) {
        // Crust
        ctx.beginPath();
        ctx.arc(cx, cy, r, 0, Math.PI * 2);
        ctx.fillStyle = '#e6a85c'; // Crust color
        ctx.fill();
        ctx.strokeStyle = '#c27e3a';
        ctx.lineWidth = 4;
        ctx.stroke();
        // Cheese
        ctx.beginPath();
        ctx.arc(cx, cy, r - 8, 0, Math.PI * 2);
        ctx.fillStyle = '#fdd835'; // Cheese color
        ctx.fill();
        // Toppings (Pepperoni)
        const toppings = [
            {x: -20, y: -20}, {x: 20, y: -30}, {x: 0, y: 0},
            {x: -30, y: 20}, {x: 30, y: 30}, {x: 40, y: -10}, {x: -10, y: 40}
        ];
        toppings.forEach(t => {
            ctx.beginPath();
            ctx.arc(cx + t.x, cy + t.y, 7, 0, Math.PI * 2);
            ctx.fillStyle = '#d32f2f';
            ctx.fill();
            ctx.stroke();
        });
    }

    function drawPieBase(ctx, cx, cy, r) {
        // Crust
        ctx.beginPath();
        ctx.arc(cx, cy, r, 0, Math.PI * 2);
        ctx.fillStyle = '#d4a276';
        ctx.fill();
        ctx.strokeStyle = '#b68a5e';
        ctx.lineWidth = 5;
        ctx.stroke();
        // Filling (e.g., Cherry)
        ctx.beginPath();
        ctx.arc(cx, cy, r - 10, 0, Math.PI * 2);
        ctx.fillStyle = '#c62828';
        ctx.fill();
        // Lattice Pattern (Simplified)
        ctx.strokeStyle = '#d4a276';
        ctx.lineWidth = 6;
        ctx.beginPath();
        ctx.moveTo(cx - r + 10, cy - 30); ctx.lineTo(cx + r - 10, cy - 30);
        ctx.moveTo(cx - r + 10, cy + 30); ctx.lineTo(cx + r - 10, cy + 30);
        ctx.moveTo(cx - 30, cy - r + 10); ctx.lineTo(cx - 30, cy + r - 10);
        ctx.moveTo(cx + 30, cy - r + 10); ctx.lineTo(cx + 30, cy + r - 10);
        ctx.stroke();
    }

    function drawAppleBase(ctx, cx, cy, r) {
        // Apple Body
        ctx.beginPath();
        ctx.arc(cx, cy + 10, r - 10, 0, Math.PI * 2); // Slightly lower and smaller
        ctx.fillStyle = '#d50000';
        ctx.fill();
        ctx.strokeStyle = '#b71c1c';
        ctx.lineWidth = 3;
        ctx.stroke();
        // Stem
        ctx.fillStyle = '#5d4037';
        ctx.fillRect(cx - 4, cy - r + 5, 8, 20);
        // Leaf
        ctx.beginPath();
        ctx.ellipse(cx + 15, cy - r + 10, 15, 8, Math.PI / 4, 0, Math.PI * 2);
        ctx.fillStyle = '#43a047';
        ctx.fill();
    }

    function drawBreadBase(ctx, cx, cy, r) {
        // Loaf Body
        ctx.beginPath();
        ctx.ellipse(cx, cy, r, r - 20, 0, 0, Math.PI * 2);
        ctx.fillStyle = '#d7ccc8';
        ctx.fill();
        ctx.strokeStyle = '#a1887f';
        ctx.lineWidth = 4;
        ctx.stroke();
        // Scores on top
        ctx.strokeStyle = '#8d6e63';
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.moveTo(cx - 40, cy - 20); ctx.lineTo(cx - 20, cy + 20);
        ctx.moveTo(cx, cy - 20); ctx.lineTo(cx + 20, cy + 20);
        ctx.moveTo(cx + 40, cy - 20); ctx.lineTo(cx + 60, cy + 20);
        ctx.stroke();
    }

    function drawPastryBase(ctx, cx, cy, r) {
        // Danich/Swirl Body
        ctx.beginPath();
        for (let i = 0; i < 5; i++) {
            ctx.ellipse(cx + Math.cos(i * Math.PI * 2 / 5) * 20, cy + Math.sin(i * Math.PI * 2 / 5) * 20, r - 20, r - 30, i * Math.PI * 2 / 5, 0, Math.PI * 2);
        }
        ctx.fillStyle = '#ffe0b2';
        ctx.fill();
        ctx.strokeStyle = '#ffb74d';
        ctx.lineWidth = 3;
        ctx.stroke();
        // Center Jam
        ctx.beginPath();
        ctx.arc(cx, cy, 20, 0, Math.PI * 2);
        ctx.fillStyle = '#ad1457';
        ctx.fill();
    }


    function drawCuts(ctx, cx, cy, r, cutType, itemType) {
        ctx.beginPath();
        ctx.lineWidth = 5;
        ctx.strokeStyle = 'white';
        ctx.lineCap = 'round';

        // Adjust cut size for some items
        let cutR = r;
        if (itemType === 'apple') cutR = r - 10;
        if (itemType === 'bread') cutR = r;

        if (cutType === 'halves') {
            // Perfect vertical line
            ctx.moveTo(cx, cy - cutR);
            ctx.lineTo(cx, cy + cutR);
        } else if (cutType === 'quarters') {
            // Perfect Cross
            ctx.moveTo(cx, cy - cutR);
            ctx.lineTo(cx, cy + cutR);
            ctx.moveTo(cx - cutR, cy);
            ctx.lineTo(cx + cutR, cy);
        } else if (cutType === 'unequal-halves') {
            // Off center vertical
            ctx.moveTo(cx + 30, cy - (cutR-5));
            ctx.lineTo(cx + 30, cy + (cutR-5));
        } else if (cutType === 'unequal-random') {
            // Weird slice
            ctx.moveTo(cx, cy);
            ctx.lineTo(cx + cutR, cy - 20);
            ctx.moveTo(cx, cy);
            ctx.lineTo(cx - cutR, cy + 10);
        }

        ctx.stroke();
    }

    function checkAnswer(isCorrect) {
        if (state.isLocked) return;
        state.isLocked = true;

        feedbackOverlay.style.visibility = 'visible';
        feedbackOverlay.style.opacity = '1';
        document.querySelector('#feedback-msg').style.transform = 'scale(1)';

        if (isCorrect) {
            state.score += 20;
            scoreEl.innerText = state.score;
            msgTitle.innerText = "Yummy!";
            msgTitle.style.color = "#4caf50";
            msgText.innerText = "That's exactly right!";
            
            // Character jump
            characterContainer.style.transform = "translateY(-20px)";
            setTimeout(() => characterContainer.style.transform = "translateY(0)", 300);

        } else {
            msgTitle.innerText = "Nice Try!";
            msgTitle.style.color = "#d32f2f";
            msgText.innerText = "That's not " + (state.currentFraction === "1/2" ? "2 equal parts." : "4 equal parts.");
        }
    }

    function nextLevel() {
        document.querySelector('#feedback-msg').style.transform = 'scale(0.8)';
        feedbackOverlay.style.opacity = '0';
        setTimeout(() => {
            feedbackOverlay.style.visibility = 'hidden';
            initRound();
        }, 300);
    }

</script>

</body>
</html>